{% extends 'base.html' %}
{% load static %}

{% block title %}Détail de la demande - Don Sang Plus{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/modern-design.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-heartbeat"></i>
                <span>Don Sang Plus</span>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <a href="{% url 'donations:donor_dashboard' %}" class="nav-item">
                <i class="fas fa-home"></i>
                <span>Tableau de bord</span>
            </a>
            <a href="{% url 'donations:donor_dashboard' %}" class="nav-item active">
                <i class="fas fa-list"></i>
                <span>Demandes</span>
            </a>
            <a href="{% url 'donations:donor_messages' %}" class="nav-item">
                <i class="fas fa-comments"></i>
                <span>Messages</span>
            </a>
            <a href="{% url 'donations:donor_history' %}" class="nav-item">
                <i class="fas fa-history"></i>
                <span>Historique</span>
            </a>
            <a href="{% url 'donations:edit_profile' %}" class="nav-item">
                <i class="fas fa-user"></i>
                <span>Profil</span>
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <a href="{% url 'accounts:logout' %}" class="nav-item text-danger">
                <i class="fas fa-sign-out-alt"></i>
                <span>Déconnexion</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Topbar -->
        <div class="topbar">
            <div class="topbar-left">
                <h1 class="page-title">Détail de la demande de sang</h1>
            </div>
            <div class="topbar-right">
                <a href="{% url 'donations:donor_dashboard' %}" class="btn-modern btn-modern-secondary">
                    <i class="fas fa-arrow-left"></i> Retour
                </a>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Request Details Card -->
            <div class="modern-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-info-circle"></i>
                        Informations de la demande
                    </h2>
                    <div class="badge-group">
                        {% if blood_request.urgency == 'immediate' %}
                            <span class="badge badge-danger">
                                <i class="fas fa-exclamation-triangle"></i> Urgence immédiate
                            </span>
                        {% elif blood_request.urgency == '24h' %}
                            <span class="badge badge-warning">
                                <i class="fas fa-clock"></i> Urgent (24h)
                            </span>
                        {% else %}
                            <span class="badge badge-info">
                                <i class="fas fa-calendar"></i> Planifié
                            </span>
                        {% endif %}
                        
                        {% if blood_request.is_fulfilled %}
                            <span class="badge badge-success">
                                <i class="fas fa-check-circle"></i> Satisfaite
                            </span>
                        {% else %}
                            <span class="badge badge-primary">
                                <i class="fas fa-hourglass-half"></i> Active
                            </span>
                        {% endif %}
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-group">
                                <label class="info-label">
                                    <i class="fas fa-hospital"></i>
                                    Établissement
                                </label>
                                <div class="info-value">{{ blood_request.hospital.hospital_name }}</div>
                            </div>
                            
                            <div class="info-group">
                                <label class="info-label">
                                    <i class="fas fa-tint"></i>
                                    Groupe sanguin requis
                                </label>
                                <div class="info-value">
                                    <span class="blood-type-badge">{{ blood_request.blood_type }}</span>
                                </div>
                            </div>
                            
                            <div class="info-group">
                                <label class="info-label">
                                    <i class="fas fa-flask"></i>
                                    Quantité nécessaire
                                </label>
                                <div class="info-value">{{ blood_request.quantity }} poche(s)</div>
                            </div>
                            
                            <div class="info-group">
                                <label class="info-label">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    Niveau d'urgence
                                </label>
                                <div class="info-value">{{ blood_request.get_urgency_display }}</div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="info-group">
                                <label class="info-label">
                                    <i class="fas fa-calendar-alt"></i>
                                    Date limite
                                </label>
                                <div class="info-value">{{ blood_request.deadline|date:"d/m/Y à H:i" }}</div>
                            </div>
                            
                            <div class="info-group">
                                <label class="info-label">
                                    <i class="fas fa-map-marker-alt"></i>
                                    Ville
                                </label>
                                <div class="info-value">{{ blood_request.city }}</div>
                            </div>
                            
                            <div class="info-group">
                                <label class="info-label">
                                    <i class="fas fa-map-pin"></i>
                                    Adresse
                                </label>
                                <div class="info-value">{{ blood_request.hospital.address }}</div>
                            </div>
                            
                            <div class="info-group">
                                <label class="info-label">
                                    <i class="fas fa-phone"></i>
                                    Contact
                                </label>
                                <div class="info-value">{{ blood_request.contact_info }}</div>
                            </div>
                        </div>
                    </div>
                    
                    {% if blood_request.description %}
                    <div class="info-group mt-4">
                        <label class="info-label">
                            <i class="fas fa-file-alt"></i>
                            Raison de la demande
                        </label>
                        <div class="info-value">{{ blood_request.description }}</div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Action Card -->
            {% if not blood_request.is_fulfilled %}
            <div class="modern-card mt-4">
                <div class="card-body text-center">
                    <h3 class="mb-3">
                        <i class="fas fa-hand-holding-heart text-danger"></i>
                        Vous pouvez aider !
                    </h3>
                    <p class="text-muted mb-4">
                        Cette demande correspond à votre groupe sanguin. Votre don peut sauver des vies.
                    </p>
                    <a href="{% url 'donations:respond_to_request' blood_request.id %}" class="btn-modern btn-modern-primary btn-modern-lg">
                        <i class="fas fa-check-circle"></i> Répondre à la demande
                    </a>
                </div>
            </div>
            {% endif %}

            <!-- Response Status / Action Button -->
            {% if user_response %}
            <div class="alert alert-info mt-4">
                <div class="d-flex align-items-center">
                    <i class="fas fa-info-circle fa-2x me-3"></i>
                    <div>
                        <h5 class="mb-1">Vous avez déjà répondu à cette demande</h5>
                        <p class="mb-0">
                            Statut : 
                            {% if user_response.status == 'accepted' %}
                                <span class="badge badge-success">Acceptée</span>
                            {% elif user_response.status == 'pending' %}
                                <span class="badge badge-warning">En attente</span>
                            {% else %}
                                <span class="badge badge-secondary">{{ user_response.get_status_display }}</span>
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
            {% else %}
            <!-- Bouton Répondre -->
            <div class="mt-4">
                <a href="{% url 'donations:respond_to_request' blood_request.id %}" class="btn-modern btn-modern-primary btn-modern-lg w-100" style="display: flex; align-items: center; justify-content: center; gap: 12px; padding: 16px; font-size: 18px;">
                    <i class="fas fa-hand-holding-heart"></i>
                    Je veux donner mon sang pour cette demande
                </a>
            </div>
            {% endif %}
        </div>
    </main>
</div>

<style>
.info-group {
    margin-bottom: 1.5rem;
}

.info-label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    color: #64748b;
    margin-bottom: 0.5rem;
}

.info-label i {
    width: 20px;
    margin-right: 0.5rem;
}

.info-value {
    font-size: 1rem;
    color: #1e293b;
    font-weight: 500;
}

.blood-type-badge {
    display: inline-block;
    background: linear-gradient(135deg, #EF4444, #DC2626);
    color: white;
    padding: 0.5rem 1.5rem;
    border-radius: 50px;
    font-size: 1.25rem;
    font-weight: 700;
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

.badge-group {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}
</style>
{% endblock %}