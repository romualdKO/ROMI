<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cr√©er une Demande - Don Sang Plus</title>
    {% load static %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/modern-design.css' %}">
</head>
<body>
    <div class="modern-sidebar">
        <div class="sidebar-logo">
            <div class="sidebar-logo-icon"><i class="fas fa-hospital"></i></div>
            <div class="sidebar-logo-text">Don Sang Plus</div>
        </div>
        <nav class="sidebar-nav">
            <a href="{% url 'donations:hospital_dashboard' %}" class="sidebar-nav-item">
                <i class="fas fa-home sidebar-nav-icon"></i> Dashboard
            </a>
            <a href="{% url 'donations:create_request' %}" class="sidebar-nav-item active">
                <i class="fas fa-plus-circle sidebar-nav-icon"></i> Nouvelle Demande
            </a>
            <a href="{% url 'donations:edit_profile' %}" class="sidebar-nav-item">
                <i class="fas fa-cog sidebar-nav-icon"></i> Param√®tres
            </a>
        </nav>
        <div class="sidebar-footer">
            <a href="{% url 'accounts:logout' %}" class="sidebar-nav-item" style="color: var(--danger-red);">
                <i class="fas fa-sign-out-alt sidebar-nav-icon"></i> D√©connexion
            </a>
        </div>
    </div>

    <div class="modern-main-content">
        <div class="modern-topbar">
            <div>
                <div class="topbar-title">Cr√©er une Demande de Sang</div>
                <div class="topbar-subtitle">Remplissez le formulaire ci-dessous</div>
            </div>
            <div class="topbar-actions">
                <a href="{% url 'donations:hospital_dashboard' %}" class="btn-modern btn-modern-secondary">
                    <i class="fas fa-arrow-left"></i> Retour
                </a>
            </div>
        </div>

        <div class="container-modern">
            {% if messages %}
                {% for message in messages %}
                    <div class="alert-modern {% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %}">
                        <div class="alert-modern-icon">
                            <i class="fas fa-{% if message.tags == 'error' %}exclamation-circle{% elif message.tags == 'success' %}check-circle{% else %}info-circle{% endif %}"></i>
                        </div>
                        <div class="alert-modern-content">{{ message }}</div>
                    </div>
                {% endfor %}
            {% endif %}

            {% if form.errors %}
                <div class="alert-modern danger">
                    <div class="alert-modern-icon"><i class="fas fa-exclamation-triangle"></i></div>
                    <div class="alert-modern-content">
                        <div class="alert-modern-title">Erreurs dans le formulaire</div>
                        <ul style="margin: 8px 0 0 20px;">
                            {% for field, errors in form.errors.items %}
                                {% for error in errors %}
                                    <li><strong>{{ field|capfirst }} :</strong> {{ error }}</li>
                                {% endfor %}
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            {% endif %}

            <div class="form-modern">
                <form method="post" action="/donations/create-request/">
                    {% csrf_token %}
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group-modern">
                                <label class="form-label-modern" for="id_blood_type">
                                    <i class="fas fa-tint" style="color: var(--primary-red);"></i>
                                    Groupe Sanguin Requis <span style="color: var(--primary-red);">*</span>
                                </label>
                                <select class="form-input-modern form-select-modern" id="id_blood_type" name="blood_type" required>
                                    <option value="">S√©lectionnez un groupe...</option>
                                    <option value="A+" {% if form.blood_type.value == 'A+' %}selected{% endif %}>A+</option>
                                    <option value="A-" {% if form.blood_type.value == 'A-' %}selected{% endif %}>A-</option>
                                    <option value="B+" {% if form.blood_type.value == 'B+' %}selected{% endif %}>B+</option>
                                    <option value="B-" {% if form.blood_type.value == 'B-' %}selected{% endif %}>B-</option>
                                    <option value="AB+" {% if form.blood_type.value == 'AB+' %}selected{% endif %}>AB+</option>
                                    <option value="AB-" {% if form.blood_type.value == 'AB-' %}selected{% endif %}>AB-</option>
                                    <option value="O+" {% if form.blood_type.value == 'O+' %}selected{% endif %}>O+</option>
                                    <option value="O-" {% if form.blood_type.value == 'O-' %}selected{% endif %}>O-</option>
                                </select>
                                {% if form.blood_type.errors %}
                                    <div class="form-error-modern">{{ form.blood_type.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group-modern">
                                <label class="form-label-modern" for="id_quantity">
                                    <i class="fas fa-flask" style="color: var(--info-blue);"></i>
                                    Quantit√© (poches) <span style="color: var(--primary-red);">*</span>
                                </label>
                                <input type="number" class="form-input-modern" id="id_quantity" name="quantity" 
                                       min="1" max="100" step="1" value="{{ form.quantity.value|default:'' }}" 
                                       placeholder="Ex: 5" required>
                                {% if form.quantity.errors %}
                                    <div class="form-error-modern">{{ form.quantity.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group-modern">
                                <label class="form-label-modern" for="id_urgency">
                                    <i class="fas fa-exclamation-circle" style="color: var(--warning-yellow);"></i>
                                    Niveau d'Urgence <span style="color: var(--primary-red);">*</span>
                                </label>
                                <select class="form-input-modern form-select-modern" id="id_urgency" name="urgency" required>
                                    <option value="">S√©lectionnez l'urgence...</option>
                                    <option value="immediate" {% if form.urgency.value == 'immediate' %}selected{% endif %}>
                                        üî¥ Urgence imm√©diate
                                    </option>
                                    <option value="24h" {% if form.urgency.value == '24h' %}selected{% endif %}>
                                        üü† Sous 24 heures
                                    </option>
                                    <option value="planned" {% if form.urgency.value == 'planned' %}selected{% endif %}>
                                        üü¢ Planifi√©
                                    </option>
                                </select>
                                {% if form.urgency.errors %}
                                    <div class="form-error-modern">{{ form.urgency.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group-modern">
                                <label class="form-label-modern" for="id_deadline">
                                    <i class="fas fa-calendar" style="color: var(--success-green);"></i>
                                    Date Limite <span style="color: var(--primary-red);">*</span>
                                </label>
                                <input type="datetime-local" class="form-input-modern" id="id_deadline" name="deadline" 
                                       value="{{ form.deadline.value|date:'Y-m-d\TH:i'|default:'' }}" required>
                                {% if form.deadline.errors %}
                                    <div class="form-error-modern">{{ form.deadline.errors.0 }}</div>
                                {% endif %}
                                <div class="form-help-modern">
                                    <i class="fas fa-info-circle"></i>
                                    Date et heure auxquelles le sang est n√©cessaire
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-8">
                            <div class="form-group-modern">
                                <label class="form-label-modern" for="id_address">
                                    <i class="fas fa-map-marker-alt" style="color: var(--info-blue);"></i>
                                    Adresse de l'h√¥pital <span style="color: var(--primary-red);">*</span>
                                </label>
                                <input type="text" class="form-input-modern" id="id_address" name="address" 
                                       value="{{ form.address.value|default:user.address }}" 
                                       placeholder="Adresse compl√®te" required>
                                {% if form.address.errors %}
                                    <div class="form-error-modern">{{ form.address.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="form-group-modern">
                                <label class="form-label-modern" for="id_city">
                                    <i class="fas fa-city" style="color: var(--info-blue);"></i>
                                    Ville <span style="color: var(--primary-red);">*</span>
                                </label>
                                <input type="text" class="form-input-modern" id="id_city" name="city" 
                                       value="{{ form.city.value|default:user.city }}" 
                                       placeholder="Ville" required>
                                {% if form.city.errors %}
                                    <div class="form-error-modern">{{ form.city.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="form-group-modern">
                        <label class="form-label-modern" for="id_description">
                            <i class="fas fa-notes-medical" style="color: var(--text-gray);"></i>
                            Description / Motif de la Demande
                        </label>
                        <textarea class="form-input-modern form-textarea-modern" id="id_description" name="description" 
                                  rows="4" placeholder="D√©crivez bri√®vement la raison de cette demande...">{{ form.description.value|default:'' }}</textarea>
                        {% if form.description.errors %}
                            <div class="form-error-modern">{{ form.description.errors.0 }}</div>
                        {% endif %}
                        <div class="form-help-modern">
                            <i class="fas fa-info-circle"></i>
                            Cette information aidera les donneurs √† comprendre l'importance de votre demande
                        </div>
                    </div>

                    <div class="card-modern" style="background: var(--primary-red-light); margin-bottom: 24px;">
                        <div style="display: flex; gap: 16px; align-items: start;">
                            <div style="color: var(--primary-red); font-size: 24px;">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; color: var(--primary-red); margin-bottom: 8px;">
                                    Information importante
                                </div>
                                <div style="font-size: 14px; color: var(--text-gray);">
                                    Votre demande sera visible par tous les donneurs compatibles. Assurez-vous que toutes les informations sont correctes avant de soumettre.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <a href="{% url 'donations:hospital_dashboard' %}" class="btn-modern btn-modern-secondary">
                            <i class="fas fa-times"></i>
                            Annuler
                        </a>
                        <button type="submit" class="btn-modern btn-modern-primary">
                            <i class="fas fa-paper-plane"></i>
                            Cr√©er la Demande
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Set minimum datetime to now
        const dateTimeInput = document.getElementById('id_deadline');
        if (dateTimeInput) {
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            dateTimeInput.min = now.toISOString().slice(0, 16);
        }
    </script>
</body>
</html>
